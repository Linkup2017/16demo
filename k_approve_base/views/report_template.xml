<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_approve_doc_template">
            <t t-call="web.basic_layout">
                <t t-set="approve_type" t-value="docs.approver_ids.mapped('approve_type')"/>
                <div class="page ">
                    <div class="oe_structure"/>
                    <div class="col-12">
                        <h3 class="text-center linkup-approval-name">
                            <span t-if="doc.doc_name" t-esc="doc.doc_name"/>
                        </h3>
                    </div>
                    <div class="row text-nowrap">
                        <div class="col-4">
                            <table class="linkup-approval-table" align="left">
                                <tr class ="linkup-common">
                                    <td
                                        class="text-left  linkup-30" >
                                        기안자
                                    </td>
                                    <td  class="text-center">
                                        <span t-field="doc.user_id.name"/>
                                    </td>
                                </tr>
                                <tr class ="linkup-common">
                                    <td
                                        class="text-left linkup-30">
                                        부서
                                    </td>
                                    <td  class="text-center">
                                        <span t-field="doc.user_id.employee_ids.department_id.name"/>
                                    </td>
                                </tr>
                                <tr class ="linkup-common">
                                    <td
                                        class="text-left linkup-30">
                                        기안일
                                    </td>
                                    <td  class="text-center">
                                        <span t-field="doc.create_on" t-options="{'widget': 'date'}"/>
                                    </td>
                                </tr>
                                <tr class ="linkup-common">
                                    <td
                                        class="text-left linkup-30">
                                        문서번호
                                    </td>
                                    <td  class="text-center">
                                        <span t-field="doc.name"/>
                                    </td>
                                </tr>
                            </table>
                        </div>


                        <div class="col-8 text-wrap">
                            <table class="linkup-approval-table-right" align="right">
                                <t t-set="approver_cnt_max" t-value= "0" />
                                <t t-foreach="doc.approver_ids"
                                   t-as="approver">
                                    <t t-set="approver_cnt_max" t-value= "approver_cnt_max + 1" />
                                </t>
                                <colgroup>
                                    <col span="1" style="width: 10px;"/>
                                    <col span="1" style="width: 100px;"/>
                                    <t t-set="approver_cnt" t-value= "0" />
                                    <t t-foreach="doc.approver_ids"
                                       t-as="approver">
                                        <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                        <t t-if="approver_cnt &lt; 5">
                                           <col span="1" style="width: 100px;"/>
                                        </t>
                                    </t>
                                </colgroup>
                                <tr class ="linkup-common">
                                    <t t-if="approver_cnt_max &lt; 5">
                                        <td rowspan="4"
                                            class="text-center" style="display:table-cell;vertical-align: middle;">
                                            결재
                                        </td>
                                    </t>
                                    <t t-else="">
                                        <td rowspan="8"
                                            class="text-center" style="display:table-cell;vertical-align: middle;">
                                            결재
                                        </td>
                                    </t>
                                    <td class="text-center" >
                                        기안자
                                    </td>
                                    <t t-set="approver_cnt" t-value= "0" />
                                    <t  t-foreach="doc.approver_ids"
                                       t-as="approver">
                                        <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                        <t t-if="approver_cnt &lt; 5">
                                           <td class="text-center" >
                                                <span t-esc="approver.job_position.name"/>
                                           </td>
                                        </t>
                                    </t>
                                </tr>
                                <tr height="80px">
                                    <td class="text-center" style="display:table-cell;vertical-align: middle;">
                                        <img t-if="doc.user_id.employee_ids.signature"
                                             t-att-src="image_data_uri(doc.user_id.employee_ids.signature)"
                                             style="max-height: 75px;"/>

                                    </td>
                                    <t t-set="approver_cnt" t-value= "0" />
                                    <t t-foreach="doc.approver_ids"
                                       t-as="approver">
                                        <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                        <t t-if="approver_cnt &lt; 5">
                                            <td class="text-center" style="display:table-cell;vertical-align: middle;">
                                                <t t-if="approver.state == 'approved'">

                                                    <img t-if="approver.user_id.employee_ids.signature"
                                                         t-att-src="image_data_uri(approver.user_id.employee_ids.signature)"
                                                         style="max-height: 75px;"/>
                                                </t>
                                            </td>
                                        </t>
                                    </t>
                                </tr>

                                <tr class ="linkup-common">
                                    <td class="text-center" >
                                        <span t-esc="doc.user_id.name"/>

                                    </td>
                                    <t t-set="approver_cnt" t-value= "0" />
                                    <t  t-foreach="doc.approver_ids"
                                       t-as="approver">
                                        <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                        <t t-if="approver_cnt &lt; 5">
                                            <td class="text-center" >
                                                <span t-esc="approver.user_id.name"/>
                                            </td>
                                        </t>
                                    </t>
                                </tr>
                                <tr class ="linkup-common">
                                    <td class="text-center" >
                                        <t t-if="doc.submit_date">
                                           <span t-esc="datetime.datetime.strftime(doc.submit_date,'%Y-%m-%d')"/>
                                        </t>
                                    </td>
                                    <t t-set="approver_cnt" t-value= "0" />
                                    <t  t-foreach="doc.approver_ids"
                                       t-as="approver">
                                        <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                        <t t-if="approver_cnt &lt; 5">
                                            <td class="text-center" >
                                                 <t t-if = "approver.date">
                                                    <span t-esc="datetime.datetime.strftime(approver.date,'%Y-%m-%d')"/>
                                                 </t>
                                            </td>
                                        </t>
                                    </t>
                                </tr>

                                <!-- -->
                                <t t-if="approver_cnt_max &gt; 4">
                                    <tr class ="linkup-common">
                                        <t t-set="approver_cnt" t-value= "0" />
                                        <t t-foreach="doc.approver_ids"
                                           t-as="approver">
                                            <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                            <t t-if="approver_cnt &gt; 4">
                                                <td class="text-center" >
                                                    <span t-esc="approver.job_position.name"/>
                                                </td>
                                            </t>
                                        </t>
                                    </tr>
                                    <tr height="80px">
                                        <t t-set="approver_cnt" t-value= "0" />
                                        <t t-foreach="doc.approver_ids"
                                           t-as="approver">
                                            <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                            <t t-if="approver_cnt &gt; 4">
                                                <td class="text-center" style="display:table-cell;vertical-align: middle;">
                                                    <t t-if="approver.state == 'approved'">
                                                        <img t-if="approver.user_id.employee_ids.signature"
                                                             t-att-src="image_data_uri(approver.user_id.employee_ids.signature)"
                                                             style="max-height: 75px;"/>
                                                    </t>
                                                </td>
                                            </t>
                                        </t>
                                    </tr>
                                    <tr class ="linkup-common">
                                        <t t-set="approver_cnt" t-value= "0" />
                                        <t t-foreach="doc.approver_ids"
                                           t-as="approver">
                                            <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                            <t t-if="approver_cnt &gt; 4">
                                                <td class="text-center" >
                                                    <span t-esc="approver.user_id.name"/>
                                                </td>
                                            </t>
                                        </t>
                                    </tr>
                                    <tr class ="linkup-common">
                                        <t t-set="approver_cnt" t-value= "0" />
                                        <t t-foreach="doc.approver_ids"
                                           t-as="approver">
                                            <t t-set="approver_cnt" t-value= "approver_cnt + 1" />
                                            <t t-if="approver_cnt &gt; 4">
                                                <td class="text-center" >
                                                    <t t-if = "approver.date">
                                                      <span t-esc="datetime.datetime.strftime(approver.date, '%Y-%m-%d')"/>
                                                    </t>
                                                </td>
                                            </t>
                                        </t>
                                    </tr>
                                </t>
                            </table>
                        </div>
                    </div>
                    <!--- -->
                    <div class="row">
                        <div class="col-12 text-wrap">
                            <table class="linkup-approval-table" >
                                <colgroup>
                                   <col span="1" style="width: 15%;"/>
                                   <col span="1" style="width: 35%;"/>
                                   <col span="1" style="width: 15%;"/>
                                   <col span="1" style="width: 35%;"/>
                                </colgroup>
                                <t t-foreach="doc.nodes" t-as="node">
                                    <tr class ="linkup-common">
                                        <td class="text-center linkup-background" >
                                            <span t-esc="node.doc_left_name"/>
                                        </td>
                                        <td class="text-left" >
                                            <span t-esc="node.doc_left_contents"/>
                                        </td>
                                        <td class="text-center linkup-background" >
                                            <span t-esc="node.doc_right_name"/>
                                        </td>
                                        <td class="text-left" >
                                            <span t-esc="node.doc_right_contents"/>
                                        </td>
                                    </tr>
                                </t>
                                <tr height = "80px">
                                    <td class="text-center linkup-background" >
                                        내용
                                    </td>
                                    <td  colspan="3"  class="text-center" >
                                        <span t-raw="doc.bigo"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <t t-if="doc.has_product != 'no'">
                        <div class="row">
                            <div class="col-12 text-wrap" style="margin-top : 30px;">
                                <table class="linkup-approval-table" >
                                    <colgroup>
                                       <col span="1" style="width: 10%;"/>
                                       <col span="1" style="width: 30%;"/>
                                       <col span="1" style="width: 30%;"/>
                                       <col span="1" style="width: 10%;"/>
                                       <col span="1" style="width: 25%;"/>
                                    </colgroup>


                                    <tr class ="linkup-common">
                                        <td class="text-center linkup-background" >
                                            번호
                                        </td>
                                        <td class="text-center linkup-background" >
                                            <span t-raw="doc.str_has_product"/>
                                        </td>
                                        <td class="text-center linkup-background" >
                                            <span t-raw="doc.str_has_description"/>
                                        </td>
                                        <td class="text-center linkup-background" >
                                            <span t-raw="doc.str_has_quantity"/>
                                        </td>
                                        <td class="text-center linkup-background" >
                                            <span t-raw="doc.str_has_amount"/>
                                        </td>
                                    </tr>
                                    <t t-set="product_cnt" t-value="0" />
                                    <t t-foreach="doc.product_line_ids" t-as="product">
                                        <t t-set="product_cnt" t-value= "product_cnt + 1" />
                                        <tr class ="linkup-common">
                                            <td class="text-center linkup-background" >
                                                <span t-raw="product_cnt"/>
                                            </td>
                                            <td class="text-left" >
                                                <span t-raw="product.product_id.name"/>
                                            </td>
                                            <td class="text-left" >
                                                <span t-raw="product.description"/>
                                            </td>
                                            <td class="text-right" >
                                                <span t-raw="product.quantity"/>
                                            </td>
                                            <td class="text-right" >
                                                 <span t-raw="product.amount"/>
                                            </td>

                                        </tr>
                                    </t>


                                </table>
                            </div>
                        </div>
                    </t>
                </div>
            </t>


        </template>
        <template id="approve_doc_print">
            <t t-foreach="docs" t-as="doc">
                <t t-set="lang"
                   t-value="doc.user_id.lang"/>
                <t t-call="k_approve_base.report_approve_doc_template" t-lang="lang"/>
            </t>
        </template>


    </data>

</odoo>